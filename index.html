<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lust Engine - ThisVid & DarknessPorn</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; margin: 0; padding: 20px; text-align: center; }
    h1 { color: #ff4081; }
    input { padding: 12px; width: 70%; max-width: 600px; font-size: 18px; border: 2px solid #ff4081; border-radius: 8px; background: #222; color: white; }
    button { padding: 12px 24px; font-size: 18px; background: #ff4081; border: none; color: white; border-radius: 8px; cursor: pointer; margin: 15px; }
    #prefs { margin: 30px auto; max-width: 700px; background: #1a1a1a; padding: 20px; border-radius: 10px; }
    ul { list-style: none; padding: 0; }
    li { margin: 8px 0; }
    #status { color: #ffeb3b; margin: 10px; font-weight: bold; }
    footer { margin-top: 50px; font-size: 0.9em; color: #888; }
  </style>
</head>
<body>

  <h1>Lust Engine</h1>
  <p>Recherche anonyme sur ThisVid + DarknessPorn (accessibles sans restriction FR)</p>

  <input type="text" id="searchInput" placeholder="Ton fantasme (ex: amateur french bdsm)" autofocus />
  <button onclick="search()">Rechercher</button>
  <div id="status"></div>
  <div id="results" style="margin: 40px auto; max-width: 1200px; padding: 0 10px;">
  <!-- Les vidéos s'afficheront ici en grille -->
</div>

  <div id="prefs">
    <h3>Préférences (local)</h3>
    <input type="text" id="tagInput" placeholder="milf +3 ou creampie -5" />
    <button onclick="addTag()">Ajouter</button>
    <ul id="tagList"></ul>
    <button onclick="resetPrefs()" style="background:#e74c3c;">Reset tout</button>
  </div>

  <footer>
    100% anonyme · Prefs dans navigateur · Sites : ThisVid & DarknessPorn (pas de geo-block FR)
  </footer>

  <script>
    const STORAGE_KEY = 'lustEnginePrefs';
    let prefs = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

    function savePrefs() { localStorage.setItem(STORAGE_KEY, JSON.stringify(prefs)); updateList(); }
    function updateList() {
      document.getElementById('tagList').innerHTML = Object.entries(prefs).map(([tag, w]) => `<li>${tag}: ${w}</li>`).join('');
    }

    function addTag() {
      const val = document.getElementById('tagInput').value.trim().toLowerCase();
      if (!val) return;
      const match = val.match(/^(.+?)\s*([+-]?\d*\.?\d*)$/);
      if (match) {
        prefs[match[1].trim()] = parseFloat(match[2]) || 1;
        savePrefs();
        document.getElementById('tagInput').value = '';
        document.getElementById('status').textContent = 'Tag ajouté';
      }
    }

    function resetPrefs() {
      if (confirm('Reset ?')) {
        prefs = {}; localStorage.removeItem(STORAGE_KEY); updateList();
        document.getElementById('status').textContent = 'Reset OK';
      }
    }

    async function search() {
  let query = document.getElementById('searchInput').value.trim();
  if (!query) return alert("Entre un fantasme !");

  let enhanced = query;
  Object.entries(prefs).forEach(([tag, w]) => { if (w > 0) enhanced += ` ${tag}`; });

  const workerUrl = 'https://lust-engine-proxy.anonymesousanonymat.workers.dev/'; // CHANGE ÇA avec ton Worker URL

  showStatus('Recherche en cours...');

  try {
    // Fetch pour ThisVid
    const resThis = await fetch(`${workerUrl}?q=${encodeURIComponent(enhanced)}&site=thisvid`);
    const dataThis = await resThis.json();

    // Fetch pour DarknessPorn
    const resDark = await fetch(`${workerUrl}?q=${encodeURIComponent(enhanced)}&site=darknessporn`);
    const dataDark = await resDark.json();
    // ... après await resDark ...

const combinedResults = [
  ...(dataThis.results || []),
  ...(dataDark.results || [])
];

// Optionnel : petit filtre ou sort basique si tu veux
displayResults(combinedResults);

    // Affiche grid
    displayResults([...(dataThis.results || []), ...(dataDark.results || [])]);

  } catch (e) {
    showStatus('Erreur proxy : ' + e.message);
  }
}

function displayResults(videos) {
  const container = document.getElementById('results');
  if (!container) {
    console.error('Div #results introuvable');
    return;
  }

  // Vide les anciens résultats pour éviter l'accumulation
  container.innerHTML = '';

  if (videos.length === 0) {
    container.innerHTML = '<p style="color:#ff9800; font-size:18px;">Aucun résultat trouvé. Essaie d\'autres tags !</p>';
    showStatus('Pas de vidéos extraites');
    return;
  }

  let html = '<h2 style="text-align:center; color:#ff4081; margin-bottom:20px;">Résultats boostés</h2>';
  html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px;">';

  videos.forEach(v => {
    // Sécurité : fallback si thumb ou title manquant
    const thumb = v.thumb || 'https://via.placeholder.com/220x150?text=No+Thumb';
    const title = v.title || 'Vidéo sans titre';
    const link = v.link || '#';

    html += `
      <div style="background:#1a1a1a; border-radius:10px; overflow:hidden; box-shadow:0 4px 8px rgba(0,0,0,0.5);">
        <a href="${link}" target="_blank" style="text-decoration:none; color:inherit; display:block;">
          <img src="${thumb}" alt="${title}" style="width:100%; height:auto; display:block;" 
               onerror="this.src='https://via.placeholder.com/220x150?text=Thumb+Error';">
          <div style="padding:10px; font-size:14px; line-height:1.4;">
            ${title}
          </div>
        </a>
      </div>`;
  });

  html += '</div>';
  container.innerHTML = html;

  showStatus(`Affichage de ${videos.length} vidéos !`);
}

    updateList();
  </script>

</body>
</html>
